(()=>{"use strict";var e={785:(e,t,r)=>{e.exports=r.p+"f6a972e245003b420821.jpg"}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.p="";var a={};(()=>{r.d(a,{e:()=>ne});var e,t,n,o,i=".profile__edit-avatar",c=".profile__edit-button",d=".profile__title",u=".profile__subtitle",l=".profile__avatar",s=".profile__add-button",f=".popup__form",p=".popup__image",v=".popup__figcaption",m={editProfile:".popup__function_edit-profile",addCart:".popup__function_add-cart",viewFoto:".popup__function_view-foto",editAvatar:".popup__function_edit-avatar"},_="popup_opened",h=".form__input",y=".form__button",S="form__input_error",P="error",b="form__error-msg_visible",q="form__button_disabled",C={name:"#name",about:"#profession",link:"#link",avatar:"#pic"},g=".cards__list",E=".cards__item",L=".cards__image",k=".cards__name",A=".cards__status",x=".cards__likes",w=".cards__delete-button",T="cards__delete-button_visible",B="cards__status_active",U="cards__image_inactive",N="#cards-template",O={cardsContainer:document.querySelector(g),cardsTemplate:document.querySelector(N),profileName:document.querySelector(d),profileProfession:document.querySelector(u),avatarImage:document.querySelector(l),editAvatarButton:document.querySelector(i),editProfileButton:document.querySelector(c),addCartButton:document.querySelector(s),editAvatarPopup:document.querySelector(m.editAvatar),editProfilePopup:document.querySelector(m.editProfile),addCartPopup:document.querySelector(m.addCart),modalShowPhoto:document.querySelector(m.viewFoto),modalImageElement:document.querySelector(p),modalTextElement:document.querySelector(v)},j={editProfile:O.editProfilePopup.querySelector(f),addCart:O.addCartPopup.querySelector(f),editAvatar:O.editAvatarPopup.querySelector(f)},I={editProfile:j.editProfile.querySelector(y),addCart:j.addCart.querySelector(y),editAvatar:j.editAvatar.querySelector(y)},D=function(e){var t=e.querySelector(y);t.classList.add(q),t.disabled=!0},M=function(e,t){e.disabled=t,e.textContent=t?"Сохранение...":"Сохранить"},J=function(e){if(e.key&&"Escape"===e.key){var t=document.querySelector(".".concat(_));z(t)}},F=function(e){var t=e.target.classList.contains("popup__close-button");(e.target.classList.contains("popup")||t)&&z(e.currentTarget)},H=function(e){e.classList.add(_),e.addEventListener("click",F),document.addEventListener("keydown",J)},z=function(e){e.classList.remove(_),e.removeEventListener("click",F),document.removeEventListener("keydown",J)},G={baseUrl:"https://nomoreparties.co/v1/plus-cohort-3",headers:{authorization:"27fae40c-b0f9-46c9-bf33-d2f2bfaeebe1","Content-Type":"application/json"}},K=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},Q=function(e){return fetch("".concat(G.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:G.headers}).then(K)},R=function(e){return fetch("".concat(G.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:G.headers}).then(K)},V=r(785),W=O.cardsTemplate.content,X=function(e,t){e.textContent=t},Y=function(e){var t;(t=e.target.previousElementSibling.id,fetch("".concat(G.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:G.headers}).then(K)).then((function(){e.target.parentNode.remove()})).catch((function(e){return te(e)}))},Z=function(e){var t;t=e.target,O.modalImageElement.src=t.src,O.modalImageElement.alt=t.alt,O.modalTextElement.textContent=t.alt,H(O.modalShowPhoto)},$=function(e){var t,r,a=W.querySelector(E).cloneNode(!0);return a.querySelector(L).src=e.link,a.querySelector(L).alt=e.name,a.querySelector(L).id=e.id,a.querySelector(k).textContent=e.name,t=e.likes,r=!1,t.forEach((function(e){e._id===ne._id&&(r=!0)})),r&&a.querySelector(A).classList.add(B),a.querySelector(x).textContent=e.likes.length,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.querySelector(L),a=e.querySelector(A),n=e.querySelector(x),o=e.querySelector(w);r.addEventListener("click",Z),r.addEventListener("error",(function(){r.src=V,r.classList.add(U),r.removeEventListener("click",Z)})),a.addEventListener("click",(function(e){e.target.classList.contains(B)?R(r.id).then((function(t){e.target.classList.remove(B),X(n,t.likes.length)})).catch((function(e){return te(e)})):Q(r.id).then((function(t){e.target.classList.add(B),X(n,t.likes.length)})).catch((function(e){return te(e)}))})),t&&(o.classList.add(T),o.addEventListener("click",Y))}(a,e.owner===ne._id),a},ee=function(e,t){e.prepend(t)},te=function(e){console.log("Возникли проблемы при работе с сервером: ".concat(e))},re=function(e,t){O.profileName.textContent=e,O.profileProfession.textContent=t},ae=function(e,t){O.avatarImage.src=t,O.avatarImage.alt="Аватар пользователя ".concat(e)},ne={},oe=fetch("".concat(G.baseUrl,"/users/me"),{headers:G.headers}).then(K),ie=fetch("".concat(G.baseUrl,"/cards"),{headers:G.headers}).then(K);Promise.all([oe,ie]).then((function(e){ne._id=e[0]._id,re(e[0].name,e[0].about),ae(e[0].name,e[0].avatar),e[1].forEach((function(e){ee(O.cardsContainer,$({name:e.name,link:e.link,id:e._id,owner:e.owner._id,likes:e.likes}))}))})).catch((function(e){return te(e)})),e=j.editProfile.querySelector(C.name),t=j.editProfile.querySelector(C.about),n=j.editAvatar.querySelector(C.avatar),O.editAvatarButton.addEventListener("click",(function(){H(O.editAvatarPopup),0===n.value.length&&D(O.editAvatarPopup)})),O.editProfileButton.addEventListener("click",(function(){var r;H(O.editProfilePopup),r=t,e.value=O.profileName.textContent,r.value=O.profileProfession.textContent})),O.addCartButton.addEventListener("click",(function(){H(O.addCartPopup),D(O.addCartPopup)})),j.editProfile.addEventListener("submit",(function(e){var t,r,a=j.editProfile.querySelector(C.name),n=j.editProfile.querySelector(C.about);e.preventDefault(),M(I.editProfile,!0),(t=a.value,r=n.value,fetch("".concat(G.baseUrl,"/users/me"),{method:"PATCH",headers:G.headers,body:JSON.stringify({name:t,about:r})}).then(K)).then((function(e){re(e.name,e.about),z(O.editProfilePopup)})).catch((function(e){return te(e)})).finally((function(){M(I.editProfile,!1)}))})),j.addCart.addEventListener("submit",(function(e){var t,r,a=j.addCart.querySelector(C.name),n=j.addCart.querySelector(C.link);e.preventDefault(),M(I.addCart,!0),(t=a.value,r=n.value,fetch("".concat(G.baseUrl,"/cards"),{method:"POST",headers:G.headers,body:JSON.stringify({name:t,link:r})}).then(K)).then((function(e){ee(O.cardsContainer,$({name:e.name,link:e.link,id:e._id,owner:e.owner._id,likes:e.likes})),z(O.addCartPopup),j.addCart.reset()})).catch((function(e){return te(e)})).finally((function(){M(I.addCart,!1)}))})),j.editAvatar.addEventListener("submit",(function(e){var t,r=j.editAvatar.querySelector(C.avatar);e.preventDefault(),M(I.editAvatar,!0),(t=r.value,fetch("".concat(G.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:G.headers,body:JSON.stringify({avatar:t})}).then(K)).then((function(e){ae(e.name,e.avatar),z(O.editAvatarPopup),j.editAvatar.reset()})).catch((function(e){return te(e)})).finally((function(){M(I.editAvatar,!1)}))})),o={formSelector:f,inputSelector:h,submitButtonSelector:y,inactiveButtonClass:q,inputErrorClass:S,errorClass:b,errorMsgPrefix:P},Array.from(document.querySelectorAll(o.formSelector)).forEach((function(e){return function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?function(e,t,r){var a=e.querySelector("#".concat(t.name,"-").concat(r.errorMsgPrefix));t.classList.remove(r.inputErrorClass),a.textContent="",a.classList.remove(r.errorClass)}(e,t,r):function(e,t,r){var a=e.querySelector("#".concat(t.name,"-").concat(r.errorMsgPrefix));t.classList.add(r.inputErrorClass),a.textContent=t.validationMessage,a.classList.add(r.errorClass)}(e,t,r)}(e,n,t),function(e,t,r){!function(e){return!e.every((function(e){return e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)}(r,a,t)}))}))}(e,o)}))})()})();