(()=>{"use strict";var e={785:(e,t,r)=>{e.exports=r.p+"f6a972e245003b420821.jpg"}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.p="";var a={};(()=>{r.d(a,{e:()=>re});var e,t,n,o=".profile__edit-avatar",i=".profile__edit-button",c=".profile__title",d=".profile__subtitle",u=".profile__avatar",l=".profile__add-button",s=".popup__form",f=".popup__image",p=".popup__figcaption",m={editProfile:".popup__function_edit-profile",addCart:".popup__function_add-cart",viewFoto:".popup__function_view-foto",editAvatar:".popup__function_edit-avatar"},v="popup_opened",_=".form__input",h=".form__button",y="form__input_error",S="error",b="form__error-msg_visible",P="form__button_disabled",q={name:"#name",about:"#profession",link:"#link",avatar:"#pic"},C=".cards__list",g=".cards__item",E=".cards__image",L=".cards__name",k=".cards__status",A=".cards__likes",x=".cards__delete-button",w="cards__delete-button_visible",B="cards__status_active",T="cards__image_inactive",U="#cards-template",N={cardsContainer:document.querySelector(C),cardsTemplate:document.querySelector(U),profileName:document.querySelector(c),profileProfession:document.querySelector(d),avatarImage:document.querySelector(u),editAvatarButton:document.querySelector(o),editProfileButton:document.querySelector(i),addCartButton:document.querySelector(l),editAvatarPopup:document.querySelector(m.editAvatar),editProfilePopup:document.querySelector(m.editProfile),addCartPopup:document.querySelector(m.addCart),modalShowPhoto:document.querySelector(m.viewFoto),modalImageElement:document.querySelector(f),modalTextElement:document.querySelector(p)},O={editProfile:N.editProfilePopup.querySelector(s),addCart:N.addCartPopup.querySelector(s),editAvatar:N.editAvatarPopup.querySelector(s)},j={editProfile:O.editProfile.querySelector(h),addCart:O.addCart.querySelector(h),editAvatar:O.editAvatar.querySelector(h)},I=function(e,t){e.disabled=t,e.textContent=t?"Сохранение...":"Сохранить"},D=function(e){var t=document.querySelector(".".concat(v));e.key&&"Escape"===e.key&&F(t)},M=function(e){var t=e.target.classList.contains("popup__close-button");e.target.classList.contains("popup")?F(e.target):t&&F(e.target.parentNode.offsetParent)},J=function(e){e.classList.add(v),e.addEventListener("click",M),document.addEventListener("keydown",D)},F=function(e){e.classList.remove(v),document.removeEventListener("keydown",D)},H={baseUrl:"https://nomoreparties.co/v1/plus-cohort-3",headers:{authorization:"27fae40c-b0f9-46c9-bf33-d2f2bfaeebe1","Content-Type":"application/json"}},z=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},G=function(e){return fetch("".concat(H.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:H.headers}).then(z)},K=function(e){return fetch("".concat(H.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:H.headers}).then(z)},Q=r(785),R=N.cardsTemplate.content,V=function(e,t){e.textContent=t},W=function(e){var t;(t=e.target.previousElementSibling.id,fetch("".concat(H.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:H.headers}).then(z)).then((function(){e.target.parentNode.remove()})).catch((function(e){return $(e)}))},X=function(e){var t;t=e.target,N.modalImageElement.src=t.src,N.modalImageElement.alt=t.alt,N.modalTextElement.textContent=t.alt,J(N.modalShowPhoto)},Y=function(e){var t,r,a=R.querySelector(g).cloneNode(!0);return a.querySelector(E).src=e.link,a.querySelector(E).alt=e.name,a.querySelector(E).id=e.id,a.querySelector(L).textContent=e.name,t=e.likes,r=!1,t.forEach((function(e){e._id===re._id&&(r=!0)})),r&&a.querySelector(k).classList.add(B),a.querySelector(A).textContent=e.likes.length,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.querySelector(E),a=e.querySelector(k),n=e.querySelector(A),o=e.querySelector(x);r.addEventListener("click",X),r.addEventListener("error",(function(){r.src=Q,r.classList.add(T),r.removeEventListener("click",X)})),a.addEventListener("click",(function(e){e.target.classList.contains(B)?K(r.id).then((function(t){e.target.classList.remove(B),V(n,t.likes.length)})).catch((function(e){return $(e)})):G(r.id).then((function(t){e.target.classList.add(B),V(n,t.likes.length)})).catch((function(e){return $(e)}))})),t&&(o.classList.add(w),o.addEventListener("click",W))}(a,e.owner===re._id),a},Z=function(e,t){e.prepend(t)},$=function(e){console.log("Возникли проблемы при работе с сервером: ".concat(e))},ee=function(e,t){N.profileName.textContent=e,N.profileProfession.textContent=t},te=function(e,t){N.avatarImage.src=t,N.avatarImage.alt="Аватар пользователя ".concat(e)},re={};fetch("".concat(H.baseUrl,"/users/me"),{headers:H.headers}).then(z).then((function(e){re._id=e._id,ee(e.name,e.about),te(e.name,e.avatar)})).catch((function(e){return $(e)})),fetch("".concat(H.baseUrl,"/cards"),{headers:H.headers}).then(z).then((function(e){e.forEach((function(e){Z(N.cardsContainer,Y({name:e.name,link:e.link,id:e._id,owner:e.owner._id,likes:e.likes}))}))})).catch((function(e){return $(e)})),e=O.editProfile.querySelector(q.name),t=O.editProfile.querySelector(q.about),N.editAvatarButton.addEventListener("click",(function(){J(N.editAvatarPopup)})),N.editProfileButton.addEventListener("click",(function(){var r;J(N.editProfilePopup),r=t,e.value=N.profileName.textContent,r.value=N.profileProfession.textContent})),N.addCartButton.addEventListener("click",(function(){var e;J(N.addCartPopup),(e=N.addCartPopup.querySelector(h)).classList.add(P),e.disabled=!0})),O.editProfile.addEventListener("submit",(function(e){var t,r,a=O.editProfile.querySelector(q.name),n=O.editProfile.querySelector(q.about);e.preventDefault(),I(j.editProfile,!0),(t=a.value,r=n.value,fetch("".concat(H.baseUrl,"/users/me"),{method:"PATCH",headers:H.headers,body:JSON.stringify({name:t,about:r})}).then(z)).then((function(e){ee(e.name,e.about)})).catch((function(e){return $(e)})).finally((function(){I(j.editProfile,!1),F(N.editProfilePopup)}))})),O.addCart.addEventListener("submit",(function(e){var t,r,a=O.addCart.querySelector(q.name),n=O.addCart.querySelector(q.link);e.preventDefault(),I(j.addCart,!0),(t=a.value,r=n.value,fetch("".concat(H.baseUrl,"/cards"),{method:"POST",headers:H.headers,body:JSON.stringify({name:t,link:r})}).then(z)).then((function(e){Z(N.cardsContainer,Y({name:e.name,link:e.link,id:e._id,owner:e.owner._id,likes:e.likes}))})).catch((function(e){return $(e)})).finally((function(){I(j.addCart,!1),F(N.addCartPopup),O.addCart.reset()}))})),O.editAvatar.addEventListener("submit",(function(e){var t,r=O.editAvatar.querySelector(q.avatar);e.preventDefault(),I(j.editAvatar,!0),(t=r.value,fetch("".concat(H.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:H.headers,body:JSON.stringify({avatar:t})}).then(z)).then((function(e){te(e.name,e.avatar)})).catch((function(e){return $(e)})).finally((function(){I(j.editAvatar,!1),F(N.editAvatarPopup),O.editAvatar.reset()}))})),n={formSelector:s,inputSelector:_,submitButtonSelector:h,inactiveButtonClass:P,inputErrorClass:y,errorClass:b,errorMsgPrefix:S},Array.from(document.querySelectorAll(n.formSelector)).forEach((function(e){return function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?function(e,t,r){var a=e.querySelector("#".concat(t.name,"-").concat(r.errorMsgPrefix));t.classList.remove(r.inputErrorClass),a.textContent="",a.classList.remove(r.errorClass)}(e,t,r):function(e,t,r){var a=e.querySelector("#".concat(t.name,"-").concat(r.errorMsgPrefix));t.classList.add(r.inputErrorClass),a.textContent=t.validationMessage,a.classList.add(r.errorClass)}(e,t,r)}(e,n,t),function(e,t,r){!function(e){return!e.every((function(e){return e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)}(r,a,t)}))}))}(e,n)}))})()})();